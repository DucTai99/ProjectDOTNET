@using Model.EF;
@using System.Globalization;
@{
    ViewBag.Title = "SingleProduct";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Breadcrumbs Area Start -->
<div class="breadcrumbs-area">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="breadcrumbs">
                    <h2>Chi tiết sản phẩm</h2>
                    <ul class="breadcrumbs-list">
                        <li>
                            <a title="Return to Home" href="@Url.Action("Index","Home")">Trang chủ</a>
                        </li>
                        <li>Chi tiết sản phẩm</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Breadcrumbs Area Start -->
<!-- Single Product Area Start -->
<div class="single-product-area section-padding">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-7">
                <div class="single-product-image-inner">
                    <!-- Tab panes -->
                    <div class="tab-content">
                        @{
                            var book = (sach)ViewData["book"];
                        }
                        <div role="tabpanel"
                             class="tab-pane active"
                             id="one"
                             style="width: 90%; margin-bottom: 30px; position: relative;">
                            <a class="venobox"
                               href="img/single-product/bg-1.jpg"
                               data-gall="gallery"
                               title="">
                                <img src="@book.hinhAnh" alt="" />
                            </a>
                            @{
                                var khuyenMai = book.khuyenMai;
                            }
                            @if (khuyenMai > 0)
                            {
                                <div style="
                              width: 15%;
                              z-index: 999;
                              position: absolute;
                              top: 0;
                              right: 0;
                            ">
                                    <img src="img/sale.png" alt="" />
                                    <p style="
                                    font-size: 20px;
                                    position: absolute;
                                    left: 50%;
                                    top: 55%;
                                    transform: translate(-50%, -50%);
                                    color: white;
                                  ">
                                        @book.khuyenMai%
                                    </p>
                                </div>
                            }
                        </div>
                        <div role="tabpanel" class="tab-pane" id="two">
                            <a class="venobox"
                               href="img/single-product/bg-2.jpg"
                               data-gall="gallery"
                               title="">
                                <img src="img/shop/tt12.jpg" alt="" />
                            </a>
                        </div>
                        <div role="tabpanel" class="tab-pane" id="three">
                            <a class="venobox"
                               href="img/single-product/bg-3.jpg"
                               data-gall="gallery"
                               title="">
                                <img src="img/shop/tt12.jpg" alt="" />
                            </a>
                        </div>
                    </div>
                    <!-- Nav tabs -->
                </div>
            </div>
            <div class="col-md-6 col-sm-5">
                <div class="single-product-details">
                    <h2>@book.tenSach</h2>
                    <div class="single-product-price">
                        @if (khuyenMai > 0)
                        {
                            var newPrice = (book.gia * 1000) - (book.gia * 1000 * khuyenMai / 100);
                            <h2>@String.Format(CultureInfo.InvariantCulture, "{0:#,#}", newPrice)đ</h2>
                            <span style="color: black; font-size: 18px;" class="old-price">
                                @String.Format(CultureInfo.InvariantCulture, "{0:#,#}", book.gia * 1000)đ
                            </span>
                        }
                        @if (khuyenMai == 0)
                        {
                            <h2>@String.Format(CultureInfo.InvariantCulture, "{0:#,#}", book.gia * 1000)đ</h2>
                        }
                    </div>
                    
                    <form action="" method="get">
                        <input style="visibility: hidden;"
                               name="maSach"
                               type="text"
                               value="1" />
                        <div class="product-attributes clearfix">
                            <span class="pull-left" id="quantity-wanted-p">
                                <span class="dec qtybutton">-</span>
                                <input id="soLuongMua"
                                       type="text"
                                       name="soLuongMua"
                                       value="1"
                                       class="cart-plus-minus-box" />
                                <span class="inc qtybutton">+</span>
                            </span>
                            <span>
                                <input type="submit"
                                       class="cart-btn btn-default"
                                       value="Thêm vào giỏ hàng" />
                            </span>
                        </div>
                    </form>

                    <div class="add-to-wishlist">
                        <a class="wish-btn" href="#">
                            <i class="far fa-heart"></i>
                            Thêm vào danh sách yêu thích
                        </a>
                    </div>

                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="p-details-tab-content">
                    <div class="p-details-tab">
                        <ul class="p-details-nav-tab" role="tablist">
                            <li role="presentation" class="active">
                                <a href="#more-info"
                                   aria-controls="more-info"
                                   role="tab"
                                   data-toggle="tab">Giới thiệu sản phẩm</a>
                            </li>
                            <li role="presentation">
                                <a href="#data"
                                   aria-controls="data"
                                   role="tab"
                                   data-toggle="tab">Thông tin sản phẩm</a>
                            </li>
                            <li role="presentation">
                                <a href="#reviews"
                                   aria-controls="reviews"
                                   role="tab"
                                   data-toggle="tab">Bình luận sản phẩm</a>
                            </li>
                        </ul>
                    </div>
                    <div class="clearfix"></div>
                    <div class="tab-content review">
                        <div role="tabpanel" class="tab-pane active" id="more-info">
                            <p>Hay cực kì</p>
                        </div>
                        <div role="tabpanel" class="tab-pane" id="data">
                            <table class="table-data-sheet">
                                <tbody>
                                    <tr class="odd">
                                        <td>Tên</td>
                                        <td>@book.tenSach</td>
                                    </tr>
                                    <tr class="even">
                                        <td>Thể loại</td>
                                        <td>@book.theloaisach.tenTheLoai</td>
                                    </tr>
                                    <tr class="odd">
                                        <td>Tên tác giả</td>
                                        <td>@book.tenTacGia</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div role="tabpanel" class="tab-pane" id="reviews">
                            <div id="product-comments-block-tab">
                                <div class="comment-here">
                                    <div class="user-comment">
                                        <i class="fas fa-user-ninja"></i>
                                    </div>
                                    <form name="commentArea" class="AreaComment">
                                        <label style="display: block;">NoName</label>
                                        <input type="text"
                                               placeholder="Thêm bình luận ...."
                                               name="commentText" />
                                        <input type="button" value="Đăng" onclick="comment()" />
                                    </form>
                                </div>
                                <div id="CommentArea">
                                    <!-- <%
                                                      ArrayList<Comment> listComment = (ArrayList<Comment>) request.getAttribute("listComment");
                                                      for (int i = 0; i < listComment.size(); i++) {
                                                  %> -->
                                    <div class="comment-here"
                                         style="
                          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.15);
                          padding: 10px 5px;
                        ">
                                        <div class="user-comment">
                                            <i class="fas fa-user-ninja"></i>
                                        </div>
                                        <div class="AreaComment"
                                             style="display: flex; flex-direction: column;">
                                            <p style="margin: 0px; font-weight: 600;">NoName</p>
                                            <p>
                                                No commnent
                                            </p>
                                        </div>
                                    </div>

                                    <!-- <%}%> -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
<!-- Single Product Area End -->
@{ 
    var dao = new Model.DAO.BooksDao();
    IEnumerable<sach> listBook = dao.listBookWithType(book.theloaisach.maTheLoai);
}
<!-- Related Product Area Start -->
<div class="related-product-area">
    <h2 class="section-title">Sản phẩm tương tự</h2>
    <div class="container">
        <div class="row">
            <div class="related-product indicator-style">

                @foreach (var relatedBook in listBook) {
                <div class="col-md-3">
                    <div class="single-banner">
                        <div class="product-wrapper">
                            <a href="#" class="single-banner-image-wrapper">
                                <img alt="" src="@relatedBook.hinhAnh" />
                            </a>
                            <div class="product-description">
                                <div class="functional-buttons">
                                    <a title="Thêm vào giỏ hàng" href="#">
                                        <i class="fa fa-shopping-cart"></i>
                                    </a>
                                    <a href="#" title="Add to Wishlist">
                                        <i class="far fa-heart"></i>
                                    </a>
                                    @{ 
                                        var idBook = "#productModal" + relatedBook.maSach;
                                    }
                                    <a href="#"
                                       title="Xem nhanh"
                                       data-toggle="modal"
                                       data-target="@idBook">
                                        <i class="fas fa-compress-alt"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                        @{
                            var khuyenMaiOfRelatedBook = relatedBook.khuyenMai;
                        }
                        @if (khuyenMaiOfRelatedBook > 0)
                        {
                            var newPrice = (relatedBook.gia * 1000) - (relatedBook.gia * 1000 * khuyenMaiOfRelatedBook / 100);
                            <div style="
                            width: 15%;
                            z-index: 999;
                            position: absolute;
                            top: 0;
                            right: 0;
                            ">
                                <img src="img/sale.png" alt="" />

                                <p style="
                                font-size: 14px;
                                position: absolute;
                                left: 15%;
                                top: 55%;
                                transform: translate(0, -50%);
                                color: white;
                                ">
                                    @relatedBook.khuyenMai%
                                </p>
                            </div>
                            <div class="banner-bottom text-center">
                                <div class="banner-bottom-title" style="height: 40px;">
                                    <a href="#">@relatedBook.tenSach</a>
                                </div>
                                <div style="color: #32b5f3;" class="price-2">
                                    @String.Format(CultureInfo.InvariantCulture, "{0:#,#}", newPrice)đ
                                    <span style="color: black;" class="old-price">@String.Format(CultureInfo.InvariantCulture, "{0:#,#}", relatedBook.gia * 1000)đ</span>
                                </div>
                            </div>
                        }
                        @if (khuyenMaiOfRelatedBook == 0)
                        {
                            <div class="banner-bottom text-center">
                                <div class="banner-bottom-title" style="height: 40px">
                                    <a href="#">
                                        @relatedBook.tenSach
                                    </a>
                                </div>
                                <div style="color: #32b5f3" class="price-2">
                                    @String.Format(CultureInfo.InvariantCulture, "{0:#,#}", relatedBook.gia * 1000)<span>đ</span>
                                </div>
                            </div>
                        }
                    </div>
                </div>
                            }
            </div>
        </div>
    </div>
</div>
<!-- Related Product Area End -->
<!--Quickview Product Start -->
<div id="quickview-wrapper">
@foreach (var relatedBook in listBook) {
        <!-- Modal -->
        var idBook = "productModal" + relatedBook.maSach;
        <div class="modal fade" id="@idBook" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button"
                                class="close"
                                data-dismiss="modal"
                                aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="modal-product" style="display: flex;">
                            <div class="product-images" style="width: 60%;">
                                <div class="main-image images">
                                    <img alt="" src="@relatedBook.hinhAnh" />
                                </div>
                            </div>
                            <div class="product-info">
                                <h1 style="font-size: 22px;">@relatedBook.tenSach</h1>
                                <div class="price-box">
                                    <p class="s-price">
                                        <span class="special-price">
                                            <span class="amount" style="font-size: 25px;">
                                                @String.Format(CultureInfo.InvariantCulture, "{0:#,#}", relatedBook.gia * 1000)đ
                                            </span>
                                        </span>
                                    </p>
                                </div>
                                <a href="#" class="see-all">Xem chi tiết</a>
                                <div class="quick-add-to-cart">
                                    <a style="
                                        display: flex;
                                        justify-content: center;
                                        align-items: center;
                                        "
                                       class="single_add_to_cart_button"
                                       href="#">Mua Ngay</a>
                                </div>
                                <div style="height: 300px; overflow-y: scroll;"
                                     class="quick-desc">
                                    Hay cực kì
                                </div>
                            </div>
                            <!-- .product-info -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
}
</div>
<!--End of Quickview Product-->
